# 不可变对象

> https://juejin.cn/post/6846687604130185230

## Immer 是什么？

Immer 是一个不可变数据的 Javascript 库，让你更方便的处理不可变数据。

## 什么是不可变数据？

不可变数据概念来源于函数式编程。函数式编程中，对已初始化的“变量”是不可以更改的，每次更改都要创建一个新的“变量”。
Javascript 在语言层没有实现不可变数据，需要借助第三方库来实现。Immer 就是其中一种实现（类似的还有 immutable.js）。

## 为什么不使用深拷贝/比较？

深拷贝会让所有组件都接收到新的数据，让 `shouldComponentUpdate` 失效。深比较每次都比较所有值，当数据层次很深且只有一个值变化时，这些比较是对性能的浪费。
视图层的代码，我们希望它更快响应，所以使用 immutable 库进行不可变数据的操作，也算是一种**空间换时间的取舍**。

## 为什么是 Immer？

### immutable.js

自己维护了一套数据结构，Javascript 的数据类型和 immutable.js 的类型需要相互转换，对数据有侵入性。
库的体积比较大（63KB），不太适合包体积紧张的移动端。
API 极其丰富，学习成本较高。
兼容性非常好，支持 IE 较老的版本。

### immer

使用 Proxy 实现，兼容性差。
体积很小（12KB），移动端友好。
API 简洁，使用 Javascript 自己的数据类型，几乎没有理解成本。

优缺点对比之下，immer 的兼容性缺点在我们的环境下完全可以忽略。使用一个不带来其他概念负担的库还是要轻松很多的。
